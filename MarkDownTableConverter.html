<!DOCTYPE html>
<html lang="ja">
  <head>
      <meta charset="utf8">
      <title>MarkDownTableConverter</title>
  </head>
<body>
<h1 style="font-size: 1.5em">MarkDownTableConverter 的な何か</h1>
<div>
  <p>
    <input type="radio" name="switch-key" value="1" checked>tsv To MarkDownTable
    &emsp;&emsp;&emsp;&emsp;
    <input type="radio" name="switch-key" value="2">MarkDownTable To tsv  
  </p>
</div>
<div>
  <p>
    <input type="checkbox" checked="checked" id="is-special-control-firstline" style="margin-left: 1.5em">１行目をデータ定義として扱う。
  </p>
</div>
<div>
  <textarea id="target-content" style="width:60%; height:10em" placeholder="Please input any code."></textarea>
</div>

<p>
  <button type="button" id="execute-function01">MarkDownTableConvertert</button>
</p>
<p>
  <textarea id="result-syntax" style="width:60%; height:10em"></textarea>
</p>

<script src="./utils/KakiStdUtil.js"></script>
<script>

NEW_LINE_CHARACTER = "\n";

targetContentElement = document.getElementById("target-content");
resultContentElement = document.getElementById("result-syntax");

document.getElementById("execute-function01").addEventListener("click", convertMarkDownTable)

//=======================================================================================================
//----------------------
//   For Develop Code
//----------------------
var forDev1 = `id	name	age	email	company_name
1	kaki	12	a@cbom	ペーパー
2	soft	34	b@cbom	架空
3	fake	69	y@xcom	税金対策
`

document.getElementById("target-content").innerHTML = forDev1;

//=======================================================================================================
var SWITCH_KEY = {
  TSV_TO_MARKDOWNTABLE : 1,
  MARKDOWNTABLE_TO_TSV : 2,
};
//=======================================================================================================

//======================================
//       convertMarkDownTable
//======================================
function convertMarkDownTable(){
  var resultSyntaxContentArray = [];
  var targetSyntaxContent = targetContentElement.value;
  var targetSyntaxContentArray =  targetSyntaxContent.split(/\r?\n/g);


  //-----< Set Control Param >-----
  var controlparam = { 
      switchKey                 : KakiStdUtil.getSelectedRadioButtonValue("switch-key")
    , isSpecialControlFirstline : document.getElementById("is-special-control-firstline").checked
    , splitChar                 : null
    , replaceChar               : null
    , columnNameLine : 0 
    , dataStartLine  : 0 
  };
  setControlParam(controlparam);


  //-----< Set ResultContentArray >-----
  var resultContentArray = [];
  setResultContentArray(resultContentArray, targetSyntaxContentArray, controlparam);


  //-----< Output Result >-----
  outputResult(resultContentArray);

  }

//=======================================================================================================
//=======================================================================================================

//-------------------------------------
//        Set Control Param
//-------------------------------------
function setControlParam(controlparam){

  //---------------------
  //
  //---------------------
  columnNameLine = 0;
  dataStartLine  = 0;

  if(controlparam.isSpecialControlFirstline){
    columnNameLine = 0;
  }else{
    columnNameLine = -1;  // Column Name Line is Not Exists
  }

  switch (parseInt(controlparam.switchKey)){
    case SWITCH_KEY.TSV_TO_MARKDOWNTABLE:
      if(controlparam.isSpecialControlFirstline){
        dataStartLine = 1;
      }else{
        dataStartLine = 0;
      }
      break
    case SWITCH_KEY.MARKDOWNTABLE_TO_TSV:
      if(controlparam.isSpecialControlFirstline){
        dataStartLine = 2;
      }else{
        dataStartLine = 0;
      }
      break
  }

  controlparam.columnNameLine = columnNameLine;
  controlparam.dataStartLine  = dataStartLine;


  //---------------------
  //
  //---------------------
  switch (parseInt(controlparam.switchKey)){
    case SWITCH_KEY.TSV_TO_MARKDOWNTABLE:
      controlparam.splitChar   = "\t";
      controlparam.replaceChar = "|";
      break;

    case SWITCH_KEY.MARKDOWNTABLE_TO_TSV:
      controlparam.splitChar   = "|";
      controlparam.replaceChar = "\t";
      break;
  }

  return;
}


//-------------------------------------
//           Output Result
//-------------------------------------
function outputResult(resultContentArray){
  var resultSyntaxContent = resultContentArray.join(NEW_LINE_CHARACTER);
  resultContentElement.textContent = resultSyntaxContent;
}


//-------------------------------------
//      Set ResultContentArray
//-------------------------------------
function setResultContentArray(resultContentArray, targetSyntaxContentArray, controlparam){


  targetSyntaxContentArray.forEach(el => {
    // console.log(el)
    // columnTypeArray = targetSyntaxContentArray[0].split(splitChar);
    // var elList = el.split(splitChar);

    // console.table({elList})
  });


  var loopStartPosition;

// console.log(controlparam.columnNameLine)

  if(controlparam.columnNameLine > -1){
    // loopStartPosition = controlparam['dataStartLine'];
    // var elList = targetSyntaxContentArray[0].split(controlparam.splitChar);

    // var el = targetSyntaxContentArray[0].replace(controlparam.splitChar, controlparam.replaceChar);
    var el = targetSyntaxContentArray[0].split(controlparam.splitChar).join(controlparam.replaceChar);
    
    if(controlparam.switchKey == SWITCH_KEY.TSV_TO_MARKDOWNTABLE){
      el = KakiStdUtil.surroundText(el, controlparam.replaceChar);
    }

    // .split(' ').join('-'); 

    console.table({el})
    resultContentArray.push(el)
  }
  // controlparam['columnNameLine'] = columnNameLine;
  // controlparam['dataStartLine']  = dataStartLine;



  for(var i=controlparam.dataStartLine; i<targetSyntaxContentArray.length; i++){
    if(targetSyntaxContentArray[i].trim().length <= 0){
      continue;
    }

    var el = targetSyntaxContentArray[i].split(controlparam.splitChar).join(controlparam.replaceChar);
    if(controlparam.switchKey == SWITCH_KEY.TSV_TO_MARKDOWNTABLE){
      el = KakiStdUtil.surroundText(el, controlparam.replaceChar);
    }
    resultContentArray.push(el)
  }


  console.table({resultContentArray})
}

//=======================================================================================================
//=======================================================================================================

</script>
</body>
</html>