<!DOCTYPE html>
<html lang="ja">
  <head>
      <meta charset="utf8">
      <title>SQL Formatter</title>
  </head>
<body>
<h1 style="font-size: 1.5em">select文を整形したい的な何か</h1>
<div>
  <textarea id="target_syntax" style="width:60%; height:10em" placeholder="Please input any Select Statement."></textarea>
</div>

<p>
  <button type="button" id="format_SelectStatement">Format SelectStatement</button>
</p>
<p>
  <textarea id="result_syntax" style="width:60%; height:10em" ></textarea>
</p>

<script>

NEW_LINE_CHARACTER = "\n";

targetSyntaxElement = document.getElementById("target_syntax");
resultSyntaxElement = document.getElementById("result_syntax");

document.getElementById("format_SelectStatement").addEventListener("click", formatSelectStatement)

//=================================================================
//----------------------
//   For Develop Code
//----------------------
var forDev1 = `
select               
    T1.TABLE1.PROD_NO,
sum(decode(T2.CATEGORY,'1',T1.SALES                 ,0              ))  as  SALES,
	sum(decode(T2.CATEGORY,'2',round(T1.PAYMENT / 1.08 ), T1.PAYMENT))  as  PAYMENT,
		sum(t1.nm1)
,max(t2.mm1)
from              
    TABLE1  AS T1           
    left join TABLE2 T2 on T1.CATEGORY_CD = T2.CATEGORY_CD
where  1=1
  and  T1.COLUMN1 = 'CD'
  param1 = 'a  b'
group by
    T1.PROD_NO

`

document.getElementById("target_syntax").innerHTML = forDev1;

//=================================================================



// SELECT col1, (SELECT id FROM XXX)


//======================================
//      Format SelectStatement
//======================================
function formatSelectStatement(){
  var targetSyntaxContent = targetSyntaxElement.value;
  var resultContent = "";

  resultSyntaxElement.textContent = ""


  //-----< Sqlstatoment To UnitArray >-----
  var unitArray = [];
  sqlstatomentToUnitArray(unitArray, targetSyntaxContent);





  // resultContent = targetSyntaxContent;




  //-----< Set ResultChunkSet >-----
  // var resultChunkSet = [];
  // setResultChunkSet(resultChunkSet, targetSyntaxContent);
  // if(resultChunkSet.length <= 0){
  //   resultSyntaxElement.textContent = "データ何かおかしいかも。" + NEW_LINE_CHARACTER + "() が無いとか。 ";
  //   return;
  // }

  // //-----< Set Result Contents >-----
  // setResultContents(resultContentArray, resultChunkSet);

  //-----< Output Result >-----
  // resultSyntaxElement.textContent = resultContent;

}

//=======================================================================================================
//=======================================================================================================

//-----------------------------
//  Sqlstatoment To UnitArray
//
// ＜後で修正する点＞
// スペースが全部カットされちゃうんで、
//  param1 = 'a  b'
// といった内容があると、ちゃんと動きません。
//-----------------------------
function sqlstatomentToUnitArray(unitArray, targetSyntaxContent){
  var tmp;

  tmp = targetSyntaxContent.trim();
  tmp = tmp.replace(/\t/g, " ");     // Replace tabs with spaces
  tmp = tmp.replace(/\r?\n/g, " ");  // Replace newlines with spaces
  tmp = tmp.replace(/\s+/g, " ");    // Replace one or more spaces by one space 

  unitArray = tmp.split(/\s/g);
  resultSyntaxElement.textContent = tmp
  console.log(unitArray)
  return true;
}

//-----------------------------
//      Set ResultChunkSet
//-----------------------------
function setResultChunkSet(resultChunkSet, targetSyntaxContent){

  return true;
}

//-----------------------------
//     Set Result Contents
//-----------------------------
function setResultContents(resultContentArray, resultChunkSet){


  return;
}


//=======================================================================================================
//=======================================================================================================

</script>
<script src="./utils/KakiUtils.js"></script>
</body>
</html>