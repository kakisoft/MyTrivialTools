<!DOCTYPE html>
<html lang="ja">
  <head>
      <meta charset="utf8">
      <title>Seq</title>
  </head>
<body>
<h2>insert文を作る的な何か</h2>

<div>
  <input type="radio" name="formatType" value="1" checked>tsv
  <input type="radio" name="formatType" value="2">csv

  <input type="checkbox" checked="checked" id="is_special_control_firstline" style="margin-left: 10em">１行目をデータ定義として扱う。（「c」の場合 『"』で囲む）
</div>

<br>
<div>
  <input type="text" id="tablename" value="__TABLENAME__">
  <br><br>
  <textarea id="target-syntax" style="width:60%; height:10em" placeholder="Please input any code."></textarea>
</div>

<p>
  <button type="button" id="create-InsertStatement">create-InsertStatement</button>
</p>
<p>
  <textarea id="result-syntax" style="width:95%; height:10em" ></textarea>
</p>

<script>

//=================================================================
//----------------------
//   For Develop Code
//----------------------
var forDev1;
forDev1 = "";
// forDev1 += ""  + "\n";
forDev1 += "	c		c	c"  + "\n";
forDev1 += "id	name	age	email	company_name"  + "\n";
forDev1 += "1	kaki	20	a@cbom	ペーパー"       + "\n";
forDev1 += "2	soft	30	b@cbom	架空"           + "\n";
forDev1 += "3	fake	45	y@xcom	税金対策"        + "\n";

document.getElementById("target-syntax").innerHTML = forDev1;
//=================================================================


var FORMAT_TYPE = {
  TSV : 1,
  CSV : 2,
};

function getSplitChar(){
  var switchKey = getSelectedRadioButtonValue("formatType")

  switch (parseInt(switchKey)){
    case FORMAT_TYPE.TSV:
      return "\t"
    case FORMAT_TYPE.CSV:
      return ","
  }
}

document.getElementById("create-InsertStatement").addEventListener("click", createInsertStatement)

//======================================
//      Create Insert Statement
//======================================
function createInsertStatement(){
  INSERT_STATEMENT_TEMPLATE = "INSERT INTO %s1 (%s2) VALUES (%s3);";
  SPECIAL_CONTROL_JUDGMENT_CHAR = "c";
  SURROUND_CHAR = "\"";
  NEW_LINE_CHARACTER = "\n";
  TABLE_NAME = document.getElementById("tablename").value;

  var splitChar = getSplitChar();
  var isSpecialControlFirstline = document.getElementById("is_special_control_firstline").checked;

  var resultSyntaxContentArray = [];
  var targetSyntaxElement = document.getElementById("target-syntax");
  var targetSyntaxContent = targetSyntaxElement.value;
  var targetSyntaxContentArray =  targetSyntaxContent.split(/\r?\n/g);

  //--------------------------
  //  Get ColumnNameLine
  //--------------------------
  var columnNameLine;
  if(isSpecialControlFirstline){
    columnNameLine = 1;
  }else{
    columnNameLine = 0;
  }

  //--------------------------
  //    Get Column Type
  //--------------------------
  var columnTypeArray;
  var specialControlColumnNumbersArray = [];
  if(isSpecialControlFirstline){
    columnTypeArray = targetSyntaxContentArray[0].split(splitChar);
    for(var i=0; i < columnTypeArray.length; i++){
      if(columnTypeArray[i] == SPECIAL_CONTROL_JUDGMENT_CHAR){
        specialControlColumnNumbersArray.push(i+1);
      }
    }
  }

  //--------------------------
  //    Get Column Content
  //--------------------------
  var columnNameArray = targetSyntaxContentArray[columnNameLine].split(splitChar);
  var numberOfColumn = columnNameArray.length;
  var columnContent = columnNameArray.join(",");

  //--------------------------
  //    Get Data Content
  //--------------------------
  var dataArray = [];
  var inputtedData;
  for(var i=(columnNameLine+1); i < targetSyntaxContentArray.length; i++){
    if(targetSyntaxContentArray[i].trim().length <= 0){
      continue;
    }

    lineOfDataArray = targetSyntaxContentArray[i].split(splitChar);
    edittedlineOfDataArray = setSpecialControlIfNeeded(lineOfDataArray, specialControlColumnNumbersArray);

    toBeSetData = edittedlineOfDataArray.join(",");
    dataArray.push(toBeSetData);
  }

  //--------------------------
  //   Set Result Contents
  //--------------------------
  var resultSyntaxContentArray = [];
  var insertStatement;
  dataArray.forEach((valueContent)=>{

    insertStatement = INSERT_STATEMENT_TEMPLATE.replace("%s1", TABLE_NAME);
    insertStatement = insertStatement.replace("%s2", columnContent);
    insertStatement = insertStatement.replace("%s3", valueContent);
    resultSyntaxContentArray.push(insertStatement);

  });

  
  //-----< Output Result >-----
  outputResult(resultSyntaxContentArray);
}

//===================================
//   Set Special Control If Needed
//===================================
function setSpecialControlIfNeeded(lineOfDataArray, specialControlColumnNumbersArray){
  if(specialControlColumnNumbersArray.length <= 0){
    return lineOfDataArray;
  }

  edittedlineOfDataArray = [];
  for(var i=0; i < lineOfDataArray.length; i++){
    value = lineOfDataArray[i];
    if (specialControlColumnNumbersArray.indexOf(i+1) >= 0){
      value = surroundText(value, SURROUND_CHAR);
    }

    edittedlineOfDataArray.push(value);
  }

  return edittedlineOfDataArray;
}

//====================
//   Output Result
//====================
function outputResult(resultSyntaxContentArray){
  var resultSyntaxElement = document.getElementById("result-syntax");
  var resultSyntaxContent = resultSyntaxContentArray.join(NEW_LINE_CHARACTER);
  resultSyntaxElement.textContent = resultSyntaxContent;
}
</script>
<script src="./utils/KakiUtils.js"></script>
</body>
</html>